<h1>通知公告</h1>
<%= link_to '新公告', new_announcement_path, class: "btn btn-large btn-primary new_button" %>
<%= link_to '所有公告', announcements_path %> | 
<%= link_to '我发起的', announcements_url(:conditions => { :user_id => current_user }) %> |
<%= link_to '待审批', being_reviewed_path %>
<table class="table">
  <thead>
    <tr>
      <th>标题</th>
      <th>发布人</th>
      <th>公告内容</th>
      <th><%= @scope == "all"? "发布时间" : (@scope == "mine"? "时间" : "发起时间") %></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @announcements.each do |announcement| %>
      <tr>
        <td><%= link_to announcement.name, announcement %></td>
        <td><%= announcement.user.username %></td>
        <td><%= announcement.content.truncate(30) %></td>
        <td><%= time_format(announcement.updated_at.getlocal) %></td>
        <% if @scope == "mine" %>
          <td><%= state_format(announcement.workflow_state) %></td>
        <% end %>
        <% if @scope == "mine" %>
          <td>
            <% if announcement.current_state == "new" %>
              <%= link_to 'Edit', edit_announcement_path(announcement) %> |
            <% end %>  
            <%= link_to 'Destroy', announcement, method: :delete, 
              data: { confirm: 'Are you sure?' } %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
<%= will_paginate @announcements%>